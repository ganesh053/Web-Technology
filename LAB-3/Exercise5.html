<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi-Stage Workflow Engine</title>
    <style>
        :root { --primary: #6366f1; --gray: #e5e7eb; --success: #22c55e; }
        body { font-family: 'Segoe UI', sans-serif; background: #f9fafb; display: flex; justify-content: center; padding: 40px; }
        
        .wizard-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        
        /* Progress Bar */
        .progress-container { margin-bottom: 30px; background: var(--gray); height: 8px; border-radius: 4px; overflow: hidden; }
        #progressBar { background: var(--primary); height: 100%; width: 25%; transition: width 0.4s ease; }
        
        .step-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; color: #1f2937; }
        .form-stage { display: none; }
        .form-stage.active { display: block; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; font-weight: 500; }
        input, select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box; }
        
        .error-hint { color: #ef4444; font-size: 0.8rem; margin-top: 5px; display: none; }
        .invalid input { border-color: #ef4444; background: #fef2f2; }

        .nav-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        button { padding: 10px 20px; border-radius: 6px; cursor: pointer; border: none; font-weight: 600; }
        .btn-next { background: var(--primary); color: white; }
        .btn-prev { background: var(--gray); color: #4b5563; }
        .btn-submit { background: var(--success); color: white; display: none; }
    </style>
</head>
<body>

<div class="wizard-card">
    <div class="progress-container">
        <div id="progressBar"></div>
    </div>

    <form id="workflowForm" novalidate>
        <div class="form-stage active" data-step="1">
            <div class="step-title">Step 1: Identity</div>
            <div class="input-group">
                <label>First Name</label>
                <input type="text" id="fname" required>
                <div class="error-hint">Please enter your first name.</div>
            </div>
            <div class="input-group">
                <label>Last Name</label>
                <input type="text" id="lname" required>
            </div>
        </div>

        <div class="form-stage" data-step="2">
            <div class="step-title">Step 2: Contact Info</div>
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="email" required>
                <div class="error-hint">Enter a valid email (e.g., name@mail.com).</div>
            </div>
        </div>

        <div class="form-stage" data-step="3">
            <div class="step-title">Step 3: Preferences</div>
            <div class="input-group">
                <label>Service Plan</label>
                <select id="plan">
                    <option value="">Select a plan...</option>
                    <option value="basic">Basic</option>
                    <option value="pro">Professional</option>
                </select>
                <div class="error-hint">Please select a plan.</div>
            </div>
        </div>

        <div class="form-stage" data-step="4">
            <div class="step-title">Step 4: Review & Submit</div>
            <div id="reviewData" style="background: #f3f4f6; padding: 15px; border-radius: 6px; font-size: 0.9rem;">
                </div>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn-prev" id="prevBtn" onclick="changeStep(-1)" disabled>Previous</button>
            <button type="button" class="btn-next" id="nextBtn" onclick="changeStep(1)">Next</button>
            <button type="submit" class="btn-submit" id="submitBtn">Finish Registration</button>
        </div>
    </form>
</div>

<script>
    let currentStep = 1;
    const totalSteps = 4;
    const formData = {}; // Temporary storage

    function changeStep(delta) {
        // Only validate if moving forward
        if (delta === 1 && !validateStage(currentStep)) return;

        // Save current inputs to formData
        saveData(currentStep);

        // Update step index
        currentStep += delta;

        // Render UI
        updateUI();
    }

    function validateStage(step) {
        const stage = document.querySelector(`.form-stage[data-step="${step}"]`);
        const inputs = stage.querySelectorAll('input, select');
        let isValid = true;

        inputs.forEach(input => {
            const group = input.closest('.input-group');
            const error = group?.querySelector('.error-hint');
            
            // Basic validation check
            const isFieldValid = input.checkValidity() && input.value.trim() !== "";
            
            if (!isFieldValid) {
                isValid = false;
                if(group) group.classList.add('invalid');
                if(error) error.style.display = 'block';
            } else {
                if(group) group.classList.remove('invalid');
                if(error) error.style.display = 'none';
            }
        });
        return isValid;
    }

    function saveData(step) {
        const stage = document.querySelector(`.form-stage[data-step="${step}"]`);
        const inputs = stage.querySelectorAll('input, select');
        inputs.forEach(input => {
            formData[input.id] = input.value;
        });
    }

    function updateUI() {
        // Show/Hide Stages
        document.querySelectorAll('.form-stage').forEach(s => s.classList.remove('active'));
        document.querySelector(`.form-stage[data-step="${currentStep}"]`).classList.add('active');

        // Progress Bar
        const progress = (currentStep / totalSteps) * 100;
        document.getElementById('progressBar').style.width = `${progress}%`;

        // Buttons
        document.getElementById('prevBtn').disabled = (currentStep === 1);
        
        if (currentStep === totalSteps) {
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'block';
            renderReview();
        } else {
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('submitBtn').style.display = 'none';
        }
    }

    function renderReview() {
        const review = document.getElementById('reviewData');
        review.innerHTML = `
            <p><strong>Name:</strong> ${formData.fname} ${formData.lname}</p>
            <p><strong>Email:</strong> ${formData.email}</p>
            <p><strong>Plan:</strong> ${formData.plan}</p>
        `;
    }

    document.getElementById('workflowForm').onsubmit = (e) => {
        e.preventDefault();
        alert("Form Submitted! Data: " + JSON.stringify(formData));
    };
</script>

</body>
</html>