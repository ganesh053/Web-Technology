<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intelligent Shopping Cart</title>
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --light: #ecf0f1; }
        body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; background: #f9f9f9; }
        .container { flex: 1; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .product-item, .cart-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; border-bottom: 1px solid #ddd;
        }
        
        .badge { background: #eee; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }
        .discount-text { color: #27ae60; font-size: 0.9rem; font-weight: bold; }
        
        button { cursor: pointer; padding: 5px 12px; border: none; border-radius: 4px; }
        .add-btn { background: var(--primary); color: white; }
        .remove-btn { background: #c0392b; color: white; }
        
        .cart-summary { margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--primary); }
        .coupon-section { margin: 15px 0; display: flex; gap: 10px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Store Products</h2>
    <div id="productCatalog"></div>
</div>

<div class="container">
    <h2>Your Cart</h2>
    <div id="cartDisplay">
        <p>Cart is empty</p>
    </div>
    
    <div class="coupon-section">
        <input type="text" id="couponInput" placeholder="Enter Coupon (e.g. SAVE10)">
        <button onclick="applyCoupon()" class="add-btn">Apply</button>
    </div>

    <div class="cart-summary" id="cartSummary">
        </div>
</div>

<script>
    // 1. Data Structure
    const products = [
        { id: 1, name: "Laptop", price: 1000, category: "Electronics" },
        { id: 2, name: "Coffee Mug", price: 15, category: "Home" },
        { id: 3, name: "Headphones", price: 150, category: "Electronics" },
        { id: 4, name: "Notebook", price: 5, category: "Stationery" }
    ];

    let cart = [];
    let activeCoupon = "";

    // 2. Initialize Catalog
    function renderCatalog() {
        const catalogDiv = document.getElementById('productCatalog');
        catalogDiv.innerHTML = products.map(p => `
            <div class="product-item">
                <span><strong>${p.name}</strong> - $${p.price} <span class="badge">${p.category}</span></span>
                <button class="add-btn" onclick="addToCart(${p.id})">Add to Cart</button>
            </div>
        `).join('');
    }

    // 3. Cart Logic
    function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        const cartItem = cart.find(item => item.id === productId);

        if (cartItem) {
            cartItem.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        updateUI();
    }

    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateUI();
    }

    function changeQuantity(productId, delta) {
        const item = cart.find(i => i.id === productId);
        if (item) {
            item.quantity += delta;
            if (item.quantity <= 0) removeFromCart(productId);
        }
        updateUI();
    }

    // 4. Discount Engine
    function calculateTotals() {
        let subtotal = 0;
        let totalDiscount = 0;
        const now = new Date();
        const isHappyHour = now.getHours() >= 14 && now.getHours() <= 16; // 2PM - 4PM

        cart.forEach(item => {
            let itemTotal = item.price * item.quantity;
            let itemDiscount = 0;

            // Rule A: Bulk Discount (Buy 3+, get 10% off specific item)
            if (item.quantity >= 3) {
                itemDiscount += itemTotal * 0.10;
            }

            // Rule B: Category-based (Electronics get $20 off if over $500)
            if (item.category === "Electronics" && itemTotal > 500) {
                itemDiscount += 20;
            }

            // Rule C: Time-based (Happy Hour 5% off everything)
            if (isHappyHour) {
                itemDiscount += (itemTotal - itemDiscount) * 0.05;
            }

            subtotal += itemTotal;
            totalDiscount += itemDiscount;
        });

        // Coupon Logic: Using String Methods
        let couponDiscount = 0;
        const cleanCoupon = activeCoupon.trim().toUpperCase();
        if (cleanCoupon.startsWith("SAVE") && cleanCoupon.length > 4) {
            const amount = parseInt(cleanCoupon.substring(4)); // Extract "10" from "SAVE10"
            if (!isNaN(amount)) {
                couponDiscount = (subtotal - totalDiscount) * (amount / 100);
            }
        }

        return { 
            subtotal, 
            discount: totalDiscount + couponDiscount, 
            final: subtotal - (totalDiscount + couponDiscount),
            happyHour: isHappyHour
        };
    }

    // 5. DOM Update Function
    function updateUI() {
        const cartDiv = document.getElementById('cartDisplay');
        const summaryDiv = document.getElementById('cartSummary');

        if (cart.length === 0) {
            cartDiv.innerHTML = "<p>Cart is empty</p>";
            summaryDiv.innerHTML = "";
            return;
        }

        cartDiv.innerHTML = cart.map(item => `
            <div class="cart-item">
                <div>
                    <strong>${item.name}</strong> (x${item.quantity})<br>
                    <small>$${item.price * item.quantity}</small>
                </div>
                <div>
                    <button onclick="changeQuantity(${item.id}, 1)">+</button>
                    <button onclick="changeQuantity(${item.id}, -1)">-button>
                    <button class="remove-btn" onclick="removeFromCart(${item.id})">Delete</button>
                </div>
            </div>
        `).join('');

        const totals = calculateTotals();
        summaryDiv.innerHTML = `
            <p>Subtotal: $${totals.subtotal.toFixed(2)}</p>
            <p class="discount-text">Total Savings: -$${totals.discount.toFixed(2)} 
                ${totals.happyHour ? '<span class="badge">Happy Hour Active!</span>' : ''}
            </p>
            <h3>Total: $${Math.max(0, totals.final).toFixed(2)}</h3>
        `;
    }

    function applyCoupon() {
        activeCoupon = document.getElementById('couponInput').value;
        updateUI();
    }

    // Init
    renderCatalog();
</script>
</body>
</html>